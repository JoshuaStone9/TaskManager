@{
    ViewData["Title"] = "Home";
}

<div class="welcome-section">
    <h2>Welcome to the Coffee Shop Task Manager</h2>
    <p>Manage tasks and track employee assignments</p>
</div>

@if (ViewBag.Error != null)
{
    <div class="error">
        <p>Error: @ViewBag.Error</p>
    </div>
}

<div class="section">
    <h3>All Tasks Overview</h3>
    <div class="task-grid">
        @if (ViewBag.Tasks != null)
        {
            @foreach (var task in ViewBag.Tasks)
            {
                var employee = ((List<WorkProject.Employee>)ViewBag.Employees).Find(e => e.Id == task.AssignedToId);
                var statusClass = task.Status.Replace(" ", "-").ToLower();
                
                <div class="task-card @statusClass">
                    <div class="task-header">
                        <h4>@task.Title</h4>
                        <span class="status-badge @statusClass">@task.Status</span>
                    </div>
                    <div class="task-body">
                        <p class="assigned-to">
                            <strong>Assigned to:</strong> 
                            <a href="/Home/EmployeeTasks/@employee?.Id">@employee?.Name</a>
                        </p>
                        <div class="task-actions">
                            <form method="post" action="/Home/UpdateTaskStatus" style="display: inline;">
                                <input type="hidden" name="id" value="@task.Id" />
                                <input type="hidden" name="status" value="In Progress" />
                                <button type="submit" class="btn-small btn-warning">Start</button>
                            </form>
                            <form method="post" action="/Home/UpdateTaskStatus" style="display: inline;">
                                <input type="hidden" name="id" value="@task.Id" />
                                <input type="hidden" name="status" value="Completed" />
                                <button type="submit" class="btn-small btn-success">Complete</button>
                            </form>
                            <form method="post" action="/Home/UpdateTaskStatus" style="display: inline;">
                                <input type="hidden" name="id" value="@task.Id" />
                                <input type="hidden" name="status" value="Not Started" />
                                <button type="submit" class="btn-small btn-secondary">Reset</button>
                            </form>
                        </div>
                    </div>
                </div>
            }
        }
    </div>
</div>

<div class="section">
    <h3>Team Members</h3>
    <div class="employee-grid">
        @if (ViewBag.Employees != null)
        {
            @foreach (var employee in ViewBag.Employees)
            {
                var taskCount = ((List<WorkTask>)ViewBag.Tasks).Count(t => t.AssignedToId == employee.Id);
                
                <div class="employee-card">
                    <div class="employee-icon"></div>
                    <h4>@employee.Name</h4>
                    <p class="employee-id">ID: @employee.Id</p>
                    <p class="task-count">@taskCount task(s) assigned</p>
                    <a href="/Home/EmployeeTasks/@employee.Id" class="btn">View Tasks</a>
                </div>
            }
        }
    </div>
</div>
